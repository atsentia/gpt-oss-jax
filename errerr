[NbConvertApp] Converting notebook examples/test_fp8_conversion_mac.ipynb to notebook
Traceback (most recent call last):
  File "/Users/amund/jax-for-gpt-oss/.venv/bin/jupyter-nbconvert", line 10, in <module>
    sys.exit(main())
             ~~~~^^
  File "/Users/amund/jax-for-gpt-oss/.venv/lib/python3.13/site-packages/jupyter_core/application.py", line 284, in launch_instance
    super().launch_instance(argv=argv, **kwargs)
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "/Users/amund/jax-for-gpt-oss/.venv/lib/python3.13/site-packages/traitlets/config/application.py", line 1075, in launch_instance
    app.start()
    ~~~~~~~~~^^
  File "/Users/amund/jax-for-gpt-oss/.venv/lib/python3.13/site-packages/nbconvert/nbconvertapp.py", line 420, in start
    self.convert_notebooks()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "/Users/amund/jax-for-gpt-oss/.venv/lib/python3.13/site-packages/nbconvert/nbconvertapp.py", line 597, in convert_notebooks
    self.convert_single_notebook(notebook_filename)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/Users/amund/jax-for-gpt-oss/.venv/lib/python3.13/site-packages/nbconvert/nbconvertapp.py", line 563, in convert_single_notebook
    output, resources = self.export_single_notebook(
                        ~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        notebook_filename, resources, input_buffer=input_buffer
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/amund/jax-for-gpt-oss/.venv/lib/python3.13/site-packages/nbconvert/nbconvertapp.py", line 487, in export_single_notebook
    output, resources = self.exporter.from_filename(
                        ~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        notebook_filename, resources=resources
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/amund/jax-for-gpt-oss/.venv/lib/python3.13/site-packages/nbconvert/exporters/exporter.py", line 201, in from_filename
    return self.from_file(f, resources=resources, **kw)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/amund/jax-for-gpt-oss/.venv/lib/python3.13/site-packages/nbconvert/exporters/exporter.py", line 220, in from_file
    return self.from_notebook_node(
           ~~~~~~~~~~~~~~~~~~~~~~~^
        nbformat.read(file_stream, as_version=4), resources=resources, **kw
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/amund/jax-for-gpt-oss/.venv/lib/python3.13/site-packages/nbconvert/exporters/notebook.py", line 36, in from_notebook_node
    nb_copy, resources = super().from_notebook_node(nb, resources, **kw)
                         ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "/Users/amund/jax-for-gpt-oss/.venv/lib/python3.13/site-packages/nbconvert/exporters/exporter.py", line 154, in from_notebook_node
    nb_copy, resources = self._preprocess(nb_copy, resources)
                         ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "/Users/amund/jax-for-gpt-oss/.venv/lib/python3.13/site-packages/nbconvert/exporters/exporter.py", line 353, in _preprocess
    nbc, resc = preprocessor(nbc, resc)
                ~~~~~~~~~~~~^^^^^^^^^^^
  File "/Users/amund/jax-for-gpt-oss/.venv/lib/python3.13/site-packages/nbconvert/preprocessors/base.py", line 48, in __call__
    return self.preprocess(nb, resources)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/Users/amund/jax-for-gpt-oss/.venv/lib/python3.13/site-packages/nbconvert/preprocessors/execute.py", line 103, in preprocess
    self.preprocess_cell(cell, resources, index)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/amund/jax-for-gpt-oss/.venv/lib/python3.13/site-packages/nbconvert/preprocessors/execute.py", line 124, in preprocess_cell
    cell = self.execute_cell(cell, index, store_history=True)
  File "/Users/amund/jax-for-gpt-oss/.venv/lib/python3.13/site-packages/jupyter_core/utils/__init__.py", line 165, in wrapped
    return loop.run_until_complete(inner)
           ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/amund/jax-for-gpt-oss/.venv/lib/python3.13/site-packages/nbclient/client.py", line 1062, in async_execute_cell
    await self._check_raise_for_error(cell, cell_index, exec_reply)
  File "/Users/amund/jax-for-gpt-oss/.venv/lib/python3.13/site-packages/nbclient/client.py", line 918, in _check_raise_for_error
    raise CellExecutionError.from_cell_and_msg(cell, exec_reply_content)
nbclient.exceptions.CellExecutionError: An error occurred while executing the following cell:
------------------
# Cell 0: Local Mac M3 Ultra setup - simulate TPU v6e for FP8 conversion testing
import os
import jax
import jax.numpy as jnp
from pathlib import Path

# Force JAX to use CPU (Mac doesn't have TPU)
os.environ['JAX_PLATFORMS'] = 'cpu'

# Pretend to be TPU v6e to trigger FP8 conversion
# (This is just for testing the conversion logic)
os.environ['COLAB_TPU_ADDR'] = 'fake-tpu-v6e'

# Verify JAX is using CPU
print("JAX devices:", jax.devices())
print("JAX backend:", jax.default_backend())

# Set strategy manually for local testing
STRATEGY = "fp8"  # Test FP8 conversion
DTYPE = jnp.float8_e4m3fn

# Set local paths (Mac uses current directory, not /content/)
# âš ï¸ UPDATE THIS: Point to the directory containing .safetensors files
# Common paths:
#   - "gpt-oss-20b/original" (HuggingFace cache structure)
#   - "/Users/yourname/models/gpt-oss-20b/original"
#   - "~/Downloads/gpt-oss-20b/original"
safetensors_path = Path("gpt-oss-20b/original")  # â† UPDATE THIS PATH!
orbax_path = f"gpt-oss-20b-orbax-{STRATEGY}"

# Verify path exists and contains .safetensors files
if not safetensors_path.exists():
    raise FileNotFoundError(
        f"Path does not exist: {safetensors_path}\n"
        f"Please update the safetensors_path in Cell 0 to point to your gpt-oss-20b download"
    )

st_files = list(safetensors_path.glob('*.safetensors'))
if len(st_files) == 0:
    # Try common subdirectories
    for subdir in ['original', 'models', '']:
        candidate = safetensors_path / subdir if subdir else safetensors_path
        st_files = list(candidate.glob('*.safetensors'))
        if st_files:
            safetensors_path = candidate
            break
    
    if len(st_files) == 0:
        raise FileNotFoundError(
            f"No .safetensors files found in: {safetensors_path}\n"
            f"Please update the safetensors_path in Cell 0 to the correct directory\n"
            f"Expected files like: model.safetensors or model-00001-of-00002.safetensors"
        )

print(f"\nâœ“ Local Mac setup complete")
print(f"  Strategy: {STRATEGY.upper()}")
print(f"  Target dtype: {DTYPE}")
print(f"  SafeTensors path: {safetensors_path}")
print(f"  Found {len(st_files)} .safetensors file(s)")
print(f"  Orbax output: {orbax_path}")
print(f"\nâš ï¸ Now run Cell 1 (Download check) then Cell 2 (Conversion)")
------------------

----- stdout -----
JAX devices: [CpuDevice(id=0)]
JAX backend: cpu
------------------

[31m---------------------------------------------------------------------------[39m
[31mFileNotFoundError[39m                         Traceback (most recent call last)
[36mCell[39m[36m [39m[32mIn[1][39m[32m, line 33[39m
[32m     31[39m [38;5;66;03m# Verify path exists and contains .safetensors files[39;00m
[32m     32[39m [38;5;28;01mif[39;00m [38;5;129;01mnot[39;00m safetensors_path.exists():
[32m---> [39m[32m33[39m     [38;5;28;01mraise[39;00m [38;5;167;01mFileNotFoundError[39;00m(
[32m     34[39m         [33mf[39m[33m"[39m[33mPath does not exist: [39m[38;5;132;01m{[39;00msafetensors_path[38;5;132;01m}[39;00m[38;5;130;01m\n[39;00m[33m"[39m
[32m     35[39m         [33mf[39m[33m"[39m[33mPlease update the safetensors_path in Cell 0 to point to your gpt-oss-20b download[39m[33m"[39m
[32m     36[39m     )
[32m     38[39m st_files = [38;5;28mlist[39m(safetensors_path.glob([33m'[39m[33m*.safetensors[39m[33m'[39m))
[32m     39[39m [38;5;28;01mif[39;00m [38;5;28mlen[39m(st_files) == [32m0[39m:
[32m     40[39m     [38;5;66;03m# Try common subdirectories[39;00m

[31mFileNotFoundError[39m: Path does not exist: gpt-oss-20b/original
Please update the safetensors_path in Cell 0 to point to your gpt-oss-20b download

